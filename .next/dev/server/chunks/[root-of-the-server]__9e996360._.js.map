{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/mahmu/OneDrive/Desktop/simonetti-hybrid/pages/api/emails/send-order-notification.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next'\r\nimport { Resend } from 'resend'\r\n\r\nconst resend = new Resend(process.env.RESEND_API_KEY)\r\n\r\ninterface EmailRequest {\r\n  type: 'order_confirmed' | 'new_order_admin' | 'order_out_for_delivery' | 'order_delivered'\r\n  order: any\r\n  recipientEmail: string\r\n}\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse\r\n) {\r\n  if (req.method !== 'POST') {\r\n    return res.status(405).json({ error: 'Method not allowed' })\r\n  }\r\n\r\n  try {\r\n    const { type, order, recipientEmail }: EmailRequest = req.body\r\n\r\n    if (!recipientEmail) {\r\n      return res.status(400).json({ error: 'Recipient email required' })\r\n    }\r\n\r\n    let emailContent = getEmailContent(type, order)\r\n\r\n    const { data, error } = await resend.emails.send({\r\n      from: 'Simonetti Gelateria <bestellung@eiscafe-simonetti.de>',\r\n      to: recipientEmail,\r\n      subject: emailContent.subject,\r\n      html: emailContent.html,\r\n    })\r\n\r\n    if (error) {\r\n      console.error('Resend error:', error)\r\n      return res.status(500).json({ error: error.message })\r\n    }\r\n\r\n    res.status(200).json({ success: true, messageId: data?.id })\r\n  } catch (error: any) {\r\n    console.error('Email error:', error)\r\n    res.status(500).json({ error: error.message || 'Failed to send email' })\r\n  }\r\n}\r\n\r\nfunction getEmailContent(type: string, order: any) {\r\n  const orderNumber = order.order_number || order.id?.slice(-6) || 'N/A'\r\n  const items = order.items || []\r\n  const total = order.total || 0\r\n  const deliveryAddress = order.delivery_address || {}\r\n\r\n  switch (type) {\r\n    case 'order_confirmed':\r\n      return {\r\n        subject: `‚úÖ Bestellung best√§tigt #${orderNumber} - Simonetti Gelateria`,\r\n        html: `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"utf-8\">\r\n  <style>\r\n    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; color: #333; }\r\n    .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n    .header { background: linear-gradient(135deg, #4a5d54 0%, #8da399 100%); color: white; padding: 30px; text-align: center; border-radius: 12px 12px 0 0; }\r\n    .content { background: #fff; padding: 30px; border: 2px solid #f0ede8; border-radius: 0 0 12px 12px; }\r\n    .order-items { background: #f9f8f4; padding: 20px; border-radius: 8px; margin: 20px 0; }\r\n    .item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb; }\r\n    .total { font-size: 24px; font-weight: bold; color: #4a5d54; text-align: right; margin-top: 15px; }\r\n    .status-badge { display: inline-block; background: #10b981; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; }\r\n    .footer { text-align: center; color: #8da399; font-size: 12px; margin-top: 30px; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"container\">\r\n    <div class=\"header\">\r\n      <h1 style=\"margin: 0; font-size: 32px;\">üç¶ Simonetti Gelateria</h1>\r\n      <p style=\"margin: 10px 0 0; opacity: 0.9;\">Ihre Bestellung wurde best√§tigt!</p>\r\n    </div>\r\n    \r\n    <div class=\"content\">\r\n      <div style=\"text-align: center; margin-bottom: 30px;\">\r\n        <span class=\"status-badge\">‚úÖ Best√§tigt</span>\r\n      </div>\r\n      \r\n      <h2 style=\"color: #4a5d54;\">Bestellung #${orderNumber}</h2>\r\n      \r\n      <p>Vielen Dank f√ºr Ihre Bestellung! Wir bereiten Ihre Leckereien gerade zu.</p>\r\n      \r\n      <div class=\"order-items\">\r\n        <h3 style=\"margin-top: 0; color: #4a5d54;\">Ihre Bestellung:</h3>\r\n        ${items.map((item: any) => `\r\n          <div class=\"item\">\r\n            <span>${item.quantity}x ${item.name}</span>\r\n            <span style=\"font-weight: 600;\">${(item.price * item.quantity).toFixed(2)} ‚Ç¨</span>\r\n          </div>\r\n        `).join('')}\r\n        <div class=\"total\">${total.toFixed(2)} ‚Ç¨</div>\r\n      </div>\r\n      \r\n      ${deliveryAddress.street ? `\r\n        <div style=\"background: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 20px;\">\r\n          <strong style=\"color: #4a5d54;\">üìç Lieferadresse:</strong><br>\r\n          ${deliveryAddress.name}<br>\r\n          ${deliveryAddress.street}<br>\r\n          ${deliveryAddress.zip} ${deliveryAddress.city}\r\n        </div>\r\n      ` : ''}\r\n      \r\n      <p style=\"margin-top: 30px; color: #666;\">\r\n        <strong>Gesch√§tzte Lieferzeit:</strong> 30-45 Minuten<br>\r\n        Sie erhalten eine weitere Email sobald Ihre Bestellung unterwegs ist.\r\n      </p>\r\n      \r\n      <div style=\"background: #fef3c7; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #f59e0b;\">\r\n        <strong>üí° Tipp:</strong> Halten Sie Ihr Handy bereit - unser Fahrer k√∂nnte Sie anrufen falls er die Adresse nicht findet.\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"footer\">\r\n      <p>Simonetti Gelateria | Langenfeld<br>\r\n      Bei Fragen: info@eiscafe-simonetti.de</p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n        `\r\n      }\r\n\r\n    case 'new_order_admin':\r\n      return {\r\n        subject: `üîî Neue Bestellung #${orderNumber} - Sofort bearbeiten!`,\r\n        html: `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"utf-8\">\r\n  <style>\r\n    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; color: #333; }\r\n    .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n    .alert { background: #fef2f2; border: 2px solid #ef4444; border-radius: 12px; padding: 20px; text-align: center; }\r\n    .content { background: #fff; padding: 30px; border: 2px solid #f0ede8; border-radius: 12px; margin-top: 20px; }\r\n    .order-items { background: #f9f8f4; padding: 20px; border-radius: 8px; margin: 20px 0; }\r\n    .item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb; }\r\n    .total { font-size: 24px; font-weight: bold; color: #4a5d54; text-align: right; margin-top: 15px; }\r\n    .btn { display: inline-block; background: #4a5d54; color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; font-weight: 600; margin-top: 20px; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"container\">\r\n    <div class=\"alert\">\r\n      <h1 style=\"margin: 0; color: #dc2626; font-size: 28px;\">üîî NEUE BESTELLUNG!</h1>\r\n      <p style=\"margin: 10px 0 0; font-size: 18px; font-weight: 600;\">Bestellung #${orderNumber}</p>\r\n    </div>\r\n    \r\n    <div class=\"content\">\r\n      <div class=\"order-items\">\r\n        <h3 style=\"margin-top: 0; color: #4a5d54;\">Bestellte Artikel:</h3>\r\n        ${items.map((item: any) => `\r\n          <div class=\"item\">\r\n            <span><strong>${item.quantity}x</strong> ${item.name}</span>\r\n            <span style=\"font-weight: 600;\">${(item.price * item.quantity).toFixed(2)} ‚Ç¨</span>\r\n          </div>\r\n        `).join('')}\r\n        <div class=\"total\">${total.toFixed(2)} ‚Ç¨</div>\r\n      </div>\r\n      \r\n      ${deliveryAddress.street ? `\r\n        <div style=\"background: #fef3c7; padding: 15px; border-radius: 8px; margin-top: 20px;\">\r\n          <strong style=\"color: #4a5d54;\">üìç Lieferadresse:</strong><br>\r\n          <span style=\"font-size: 18px; font-weight: 600;\">${deliveryAddress.name}</span><br>\r\n          ${deliveryAddress.street}<br>\r\n          ${deliveryAddress.zip} ${deliveryAddress.city}\r\n        </div>\r\n      ` : ''}\r\n      \r\n      ${order.notes ? `\r\n        <div style=\"background: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 20px;\">\r\n          <strong>üí¨ Kundennotiz:</strong><br>\r\n          ${order.notes}\r\n        </div>\r\n      ` : ''}\r\n      \r\n      <div style=\"background: #dcfce7; padding: 15px; border-radius: 8px; margin-top: 20px;\">\r\n        <strong>üí≥ Zahlungsmethode:</strong> ${order.payment_method === 'stripe' ? 'Kreditkarte (bereits bezahlt)' : 'Unbekannt'}<br>\r\n        <strong>‚è∞ Bestellzeit:</strong> ${new Date(order.date || Date.now()).toLocaleString('de-DE')}\r\n      </div>\r\n      \r\n      <div style=\"text-align: center;\">\r\n        <a href=\"${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/admin\" class=\"btn\">\r\n          üéØ Zum Admin-Bereich\r\n        </a>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n        `\r\n      }\r\n\r\n    case 'order_out_for_delivery':\r\n      return {\r\n        subject: `üõµ Ihre Bestellung ist unterwegs! #${orderNumber}`,\r\n        html: `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"utf-8\">\r\n  <style>\r\n    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; color: #333; }\r\n    .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n    .header { background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); color: white; padding: 30px; text-align: center; border-radius: 12px 12px 0 0; }\r\n    .content { background: #fff; padding: 30px; border: 2px solid #f0ede8; border-radius: 0 0 12px 12px; }\r\n    .status-badge { display: inline-block; background: #3b82f6; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; }\r\n    .highlight { background: #dbeafe; padding: 20px; border-radius: 8px; border-left: 4px solid #3b82f6; margin: 20px 0; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"container\">\r\n    <div class=\"header\">\r\n      <h1 style=\"margin: 0; font-size: 32px;\">üõµ Unterwegs zu Ihnen!</h1>\r\n      <p style=\"margin: 10px 0 0; opacity: 0.9;\">Ihr Eis ist gleich da!</p>\r\n    </div>\r\n    \r\n    <div class=\"content\">\r\n      <div style=\"text-align: center; margin-bottom: 30px;\">\r\n        <span class=\"status-badge\">üõµ An Fahrer √ºbergeben</span>\r\n      </div>\r\n      \r\n      <h2 style=\"color: #3b82f6;\">Bestellung #${orderNumber}</h2>\r\n      \r\n      <div class=\"highlight\">\r\n        <p style=\"margin: 0; font-size: 18px; font-weight: 600;\">\r\n          ‚è±Ô∏è Voraussichtliche Ankunft: <span style=\"color: #3b82f6;\">5-15 Minuten</span>\r\n        </p>\r\n      </div>\r\n      \r\n      <p>Ihr Fahrer ist bereits auf dem Weg zu Ihnen! Bitte halten Sie Ausschau nach unserem Lieferfahrzeug.</p>\r\n      \r\n      ${deliveryAddress.street ? `\r\n        <div style=\"background: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 20px;\">\r\n          <strong style=\"color: #3b82f6;\">üìç Lieferadresse:</strong><br>\r\n          ${deliveryAddress.name}<br>\r\n          ${deliveryAddress.street}<br>\r\n          ${deliveryAddress.zip} ${deliveryAddress.city}\r\n        </div>\r\n      ` : ''}\r\n      \r\n      <div style=\"background: #fef3c7; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #f59e0b;\">\r\n        <strong>üí° Hinweis:</strong> Unser Fahrer k√∂nnte Sie anrufen falls er Hilfe beim Finden der Adresse ben√∂tigt.\r\n      </div>\r\n      \r\n      <p style=\"margin-top: 30px; text-align: center; color: #666;\">\r\n        Guten Appetit! üç¶<br>\r\n        <strong>Ihr Simonetti Team</strong>\r\n      </p>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n        `\r\n      }\r\n\r\n    case 'order_delivered':\r\n      return {\r\n        subject: `‚úÖ Bestellung zugestellt #${orderNumber} - Guten Appetit!`,\r\n        html: `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"utf-8\">\r\n  <style>\r\n    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; color: #333; }\r\n    .container { max-width: 600px; margin: 0 auto; padding: 20px; }\r\n    .header { background: linear-gradient(135deg, #10b981 0%, #34d399 100%); color: white; padding: 30px; text-align: center; border-radius: 12px 12px 0 0; }\r\n    .content { background: #fff; padding: 30px; border: 2px solid #f0ede8; border-radius: 0 0 12px 12px; }\r\n    .status-badge { display: inline-block; background: #10b981; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; }\r\n    .rating { text-align: center; padding: 20px; background: #f9f8f4; border-radius: 8px; margin: 20px 0; }\r\n    .star { font-size: 32px; cursor: pointer; margin: 0 5px; }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"container\">\r\n    <div class=\"header\">\r\n      <h1 style=\"margin: 0; font-size: 32px;\">‚úÖ Zugestellt!</h1>\r\n      <p style=\"margin: 10px 0 0; opacity: 0.9;\">Guten Appetit!</p>\r\n    </div>\r\n    \r\n    <div class=\"content\">\r\n      <div style=\"text-align: center; margin-bottom: 30px;\">\r\n        <span class=\"status-badge\">‚úÖ Geliefert</span>\r\n      </div>\r\n      \r\n      <h2 style=\"color: #10b981; text-align: center;\">Bestellung #${orderNumber}</h2>\r\n      \r\n      <p style=\"text-align: center; font-size: 18px;\">\r\n        Ihre Bestellung wurde erfolgreich zugestellt!<br>\r\n        Wir w√ºnschen Ihnen einen guten Appetit! üç¶\r\n      </p>\r\n      \r\n      <div style=\"background: #dcfce7; padding: 20px; border-radius: 8px; margin: 30px 0; text-align: center;\">\r\n        <p style=\"margin: 0; font-size: 16px;\">\r\n          <strong>‚ù§Ô∏è Hat es geschmeckt?</strong><br>\r\n          Wir w√ºrden uns √ºber Ihr Feedback freuen!\r\n        </p>\r\n      </div>\r\n      \r\n      <p style=\"text-align: center; color: #666; margin-top: 30px;\">\r\n        Vielen Dank f√ºr Ihre Bestellung!<br>\r\n        <strong>Bis zum n√§chsten Mal! üëã</strong>\r\n      </p>\r\n      \r\n      <div style=\"text-align: center; margin-top: 30px; padding-top: 30px; border-top: 2px solid #f0ede8;\">\r\n        <p style=\"color: #8da399; font-size: 14px;\">\r\n          Simonetti Gelateria | Langenfeld<br>\r\n          info@eiscafe-simonetti.de\r\n        </p>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</body>\r\n</html>\r\n        `\r\n      }\r\n\r\n    default:\r\n      return {\r\n        subject: `Eiscafe Simonetti - Bestellung #${orderNumber}`,\r\n        html: `<p>Ihre Bestellung wurde aktualisiert.</p>`\r\n      }\r\n  }\r\n}"],"names":[],"mappings":";;;;AACA;;;;;;AAEA,MAAM,SAAS,IAAI,iNAAM,CAAC,QAAQ,GAAG,CAAC,cAAc;AAQrC,eAAe,QAC5B,GAAmB,EACnB,GAAoB;IAEpB,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,cAAc,EAAE,GAAiB,IAAI,IAAI;QAE9D,IAAI,CAAC,gBAAgB;YACnB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAA2B;QAClE;QAEA,IAAI,eAAe,gBAAgB,MAAM;QAEzC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC;YAC/C,MAAM;YACN,IAAI;YACJ,SAAS,aAAa,OAAO;YAC7B,MAAM,aAAa,IAAI;QACzB;QAEA,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO,MAAM,OAAO;YAAC;QACrD;QAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;YAAM,WAAW,MAAM;QAAG;IAC5D,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAuB;IACxE;AACF;AAEA,SAAS,gBAAgB,IAAY,EAAE,KAAU;IAC/C,MAAM,cAAc,MAAM,YAAY,IAAI,MAAM,EAAE,EAAE,MAAM,CAAC,MAAM;IACjE,MAAM,QAAQ,MAAM,KAAK,IAAI,EAAE;IAC/B,MAAM,QAAQ,MAAM,KAAK,IAAI;IAC7B,MAAM,kBAAkB,MAAM,gBAAgB,IAAI,CAAC;IAEnD,OAAQ;QACN,KAAK;YACH,OAAO;gBACL,SAAS,CAAC,wBAAwB,EAAE,YAAY,sBAAsB,CAAC;gBACvE,MAAM,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8CA6B+B,EAAE,YAAY;;;;;;QAMpD,EAAE,MAAM,GAAG,CAAC,CAAC,OAAc,CAAC;;kBAElB,EAAE,KAAK,QAAQ,CAAC,EAAE,EAAE,KAAK,IAAI,CAAC;4CACJ,EAAE,CAAC,KAAK,KAAK,GAAG,KAAK,QAAQ,EAAE,OAAO,CAAC,GAAG;;QAE9E,CAAC,EAAE,IAAI,CAAC,IAAI;2BACO,EAAE,MAAM,OAAO,CAAC,GAAG;;;MAGxC,EAAE,gBAAgB,MAAM,GAAG,CAAC;;;UAGxB,EAAE,gBAAgB,IAAI,CAAC;UACvB,EAAE,gBAAgB,MAAM,CAAC;UACzB,EAAE,gBAAgB,GAAG,CAAC,CAAC,EAAE,gBAAgB,IAAI,CAAC;;MAElD,CAAC,GAAG,GAAG;;;;;;;;;;;;;;;;;;;QAmBL,CAAC;YACH;QAEF,KAAK;YACH,OAAO;gBACL,SAAS,CAAC,oBAAoB,EAAE,YAAY,qBAAqB,CAAC;gBAClE,MAAM,CAAC;;;;;;;;;;;;;;;;;;;;kFAoBmE,EAAE,YAAY;;;;;;QAMxF,EAAE,MAAM,GAAG,CAAC,CAAC,OAAc,CAAC;;0BAEV,EAAE,KAAK,QAAQ,CAAC,WAAW,EAAE,KAAK,IAAI,CAAC;4CACrB,EAAE,CAAC,KAAK,KAAK,GAAG,KAAK,QAAQ,EAAE,OAAO,CAAC,GAAG;;QAE9E,CAAC,EAAE,IAAI,CAAC,IAAI;2BACO,EAAE,MAAM,OAAO,CAAC,GAAG;;;MAGxC,EAAE,gBAAgB,MAAM,GAAG,CAAC;;;2DAGyB,EAAE,gBAAgB,IAAI,CAAC;UACxE,EAAE,gBAAgB,MAAM,CAAC;UACzB,EAAE,gBAAgB,GAAG,CAAC,CAAC,EAAE,gBAAgB,IAAI,CAAC;;MAElD,CAAC,GAAG,GAAG;;MAEP,EAAE,MAAM,KAAK,GAAG,CAAC;;;UAGb,EAAE,MAAM,KAAK,CAAC;;MAElB,CAAC,GAAG,GAAG;;;6CAGgC,EAAE,MAAM,cAAc,KAAK,WAAW,kCAAkC,YAAY;wCACzF,EAAE,IAAI,KAAK,MAAM,IAAI,IAAI,KAAK,GAAG,IAAI,cAAc,CAAC,SAAS;;;;iBAIpF,EAAE,6DAAmC,wBAAwB;;;;;;;;QAQtE,CAAC;YACH;QAEF,KAAK;YACH,OAAO;gBACL,SAAS,CAAC,mCAAmC,EAAE,aAAa;gBAC5D,MAAM,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;8CA0B+B,EAAE,YAAY;;;;;;;;;;MAUtD,EAAE,gBAAgB,MAAM,GAAG,CAAC;;;UAGxB,EAAE,gBAAgB,IAAI,CAAC;UACvB,EAAE,gBAAgB,MAAM,CAAC;UACzB,EAAE,gBAAgB,GAAG,CAAC,CAAC,EAAE,gBAAgB,IAAI,CAAC;;MAElD,CAAC,GAAG,GAAG;;;;;;;;;;;;;;QAcL,CAAC;YACH;QAEF,KAAK;YACH,OAAO;gBACL,SAAS,CAAC,yBAAyB,EAAE,YAAY,iBAAiB,CAAC;gBACnE,MAAM,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;kEA2BmD,EAAE,YAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QA6BxE,CAAC;YACH;QAEF;YACE,OAAO;gBACL,SAAS,CAAC,gCAAgC,EAAE,aAAa;gBACzD,MAAM,CAAC,0CAA0C,CAAC;YACpD;IACJ;AACF"}}]
}